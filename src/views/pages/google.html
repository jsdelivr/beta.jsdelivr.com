<link rel="ractive" href="../r-page.html">

<r-page noYield="{{noYield}}" title="{{title}}" description="{{description}}" noFooter="true">
	<div class="p-google">
		<div class="bg">
			<div class="bg-inner"></div>
		</div>

		<div class="content">
			<div class="title">
				<h1>Migrating from Google hosted libraries to jsDelivr</h1>

				<h2 class="subtitle">
					jsDelivr is a free, fast, and reliable Open Source CDN for npm and GitHub. <br>
					Most Google hosted library links can be easily converted to jsDelivr links.
				</h2>
			</div>

			<div class="container">
				<div class="box">
					<div class="bar {{#if out}}active{{/if}}">
						<div class="circle"></div>
						<div class="line"><div class="line-inner"></div></div>
						<div class="circle circle-bottom"></div>
					</div>

					<div class="icon-competitor">
						<img width="154" height="50" src="{{@shared.assetsHost}}/img/google.png" srcset="{{@shared.assetsHost}}/img/google@2x.png 2x">
					</div>

					<div class="input-wrapper">
						<input type="text" class="input {{#if out}}active{{/if}}" placeholder="Paste a Google hosted library link here" value="{{in}}">
					</div>

					<div class="icon-jsdelivr">
						<img width="140" height="34" src="{{@shared.assetsHost}}/img/logo-horizontal.svg">
					</div>

					<div class="input-wrapper">
						<input type="text" class="input {{#if out && !error}}input-jsdelivr-copy{{/if}} {{#if out}}active{{/if}}" placeholder="Get a jsDelivr link here" value="{{out}}">

						{{#if out && !error}}
							<a class="copy" as-clipboard data-clipboard-text="{{out}}">Copy</a>
						{{/if}}
					</div>

					{{#if displayHtmlWarning}}
						<div class="alert alert-warning" role="alert">
							For security reasons, we serve HTML files with <code>Content-Type: text/plain</code>.
							We recommend using <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> if this is a problem.
						</div>
					{{else}}
						<div style="height: 1px;"></div>
					{{/if}}

					<div class="buttons">
						<a href="/" class="start-using">See All Features</a>
					</div>
				</div>
			</div>

			<div class="container">
				<h1 class="comparison-title">Google hosted libraries and jsDelivr comparison</h1>

				<div class="c-stats-table">
					<table class="stats-table-table">
						<colgroup>
							<col style="width: 26%;">
							<col style="width: 37%;">
							<col style="width: 37%;">
						</colgroup>

						<thead>
							<tr>
								<th></th>
								<th>
									<div class="icon-competitor">
										<img width="154" height="50" src="{{@shared.assetsHost}}/img/google.png" srcset="{{@shared.assetsHost}}/img/google@2x.png 2x">
									</div>
								</th>
								<th>
									<div class="icon-jsdelivr">
										<img width="140" height="34" src="{{@shared.assetsHost}}/img/logo-horizontal.svg">
									</div>
								</th>
							</tr>
						</thead>

						<tbody>
							<tr>
								<td>Multi-CDN <sup><i class="fa fa-info-circle" as-tooltip="'Uses multiple independent CDN providers'"></i></sup></td>
								<td>1</td>
								<td>4</td>
							</tr>
							<tr>
								<td>Multi-DNS <sup><i class="fa fa-info-circle" as-tooltip="'Uses multiple independent DNS providers'"></i></sup></td>
								<td>1</td>
								<td>2</td>
							</tr>
							<tr>
								<td>Smart load-balancing <sup><i class="fa fa-info-circle" as-tooltip="'Chooses the best provider for each individual user'"></i></sup></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png" srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
							<tr>
								<td>Combining multiple files </td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png" srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
							<tr>
								<td>Fully featured API <sup><i class="fa fa-info-circle" as-tooltip="'Package version listings, directory listings, and detailed usage stats'"></i></sup></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png" srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
							<tr>
								<td>Cache purge API <sup><i class="fa fa-info-circle" as-tooltip="'Instantly refresh a file cached on the CDN'"></i></sup></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png" srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
							<tr>
								<td>Download stats</td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png"  srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
							<tr>
								<td>POPs in China  <sup><i class="fa fa-info-circle" as-tooltip="'Including a valid ICP license'"></i></sup></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon.png" srcset="{{@shared.assetsHost}}/img/icons/feature-unsupported-icon@2x.png 2x" loading="lazy"></td>
								<td class="tick"><img width="30" height="30" src="{{@shared.assetsHost}}/img/landing/features-list-icon.png" srcset="{{@shared.assetsHost}}/img/landing/features-list-icon@2x.png 2x" loading="lazy"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</r-page>

<script>
	/* eslint-disable no-throw-literal */

	const debounce = require('../../public/js/utils/debounce');
	const throttle = require('../../public/js/utils/throttle');
	const clipboard = require('../../public/js/decorators/clipboard');
	const tooltip = require('../../public/js/decorators/tooltip');
	const defaultError = 'Sorry, this doesn\'t look like a valid Google hosted library link :(';

	const options = {
		'd3js': {
			getPath (version, file) {
				return `/npm/d3@${version}/dist/${file}`;
			},
		},
		'dojo': {
			getPath (version, file) {
				return `/gh/dojo/dojo@${version}/${file.slice(5, -3)}.min.js`;
			},
		},
		'hammerjs': {
			getPath (version, file) {
				return `/npm/hammerjs@${version}/${file}`;
			},
		},
		'indefinite-observable': {
			getPath (version, file) {
				return `/npm/indefinite-observable@${version}/dist/${file}`;
			},
		},
		'jquery': {
			getPath (version, file) {
				return `/npm/jquery@${version}/dist/${file}`;
			},
		},
		'jquerymobile': {
			getPath (version, file) {
				return `/npm/jquery-mobile@${version}/dist/${file}`;
			},
			isError (version, file) {
				if (version !== '1.4.1' || (!file.endsWith('js') && !file.endsWith('css'))) {
					return true;
				}
			},
		},
		'jqueryui': {
			getPath (version, file) {
				return `/npm/jquery-ui-dist@${version}/${file}`;
			},
			isError (version, file) {
				if (file.includes('themes')) {
					return true;
				}
			},
		},
		'mootools': {
			getPath () {
				return `/npm/mootools-core-dist@1.5.1/dist/mootools-core.min.js`;
			},
		},
		'myanmar-tools': {
			getPath (version, file) {
				return `/npm/myanmar-tools@${version}/build_node/${file}`;
			},
		},
		'shaka-player': {
			getPath (version, file) {
				return `/npm/shaka-player@${version}/dist/${file}`;
			},
		},
		'spf': {
			getPath (version, file) {
				return `/npm/spf@${version}/dist/${file}`;
			},
		},
		'swfobject': {
			getPath (version, file) {
				return `/gh/swfobject/swfobject@2.2.0/${file}`;
			},
			isError (version) {
				if (version !== '2.2') {
					return true;
				}
			},
		},
		'threejs': {
			getPath (version, file) {
				return `/npm/three@0.${version.slice(-2)}.0/build/${file}`;
			},
		},
		'webfont': {
			getPath (version, file) {
				return `/npm/webfontloader@${version}/${file.slice(0, -3)}loader.js`;
			},
		},
	};

	component.exports = {
		decorators: {
			clipboard,
			tooltip,
		},
		data () {
			return {
				title: 'Migrate from Google hosted libraries to jsDelivr',
				description: 'Migrate from Google hosted libraries to jsDelivr - a free, fast, and reliable Open Source CDN for npm and GitHub with the largest network and best performance. Serving more than 30 billion requests per month.',
			};
		},
		oninit () {
			let google2jsDelivr = google => Promise.resolve().then(() => {
				let pattern = /^https?:\/\/ajax\.googleapis\.com\/ajax\/libs\/([^/@]+)\/([^/@]+)\/(.*)$/i;
				let match = pattern.exec(google);

				if (match) {
					let [ , name, version, file ] = match;

					if (options[name].isError && options[name].isError(version, file)) {
						throw defaultError;
					} else {
						return `https://cdn.jsdelivr.net${options[name].getPath(version, file)}`;
					}
				}

				throw defaultError;
			});

			this.observe('in', debounce(throttle((google) => {
				this.set('displayHtmlWarning', google.slice(-5) === '.html');

				if (!google) {
					return this.set('out', '');
				}

				google2jsDelivr(google).then((jsDelivr) => {
					this.set('error', false);

					if (this.get('in') === google) {
						this.set('out', jsDelivr);
					}
				}).catch((error) => {
					this.set('error', true);
					this.set('out', typeof error === 'string' ? error : defaultError);
				});
			}, 1000)));
		},
	};
</script>
