<div class="c-markdown">
	{{{markdown(text)}}}
</div>

<script>
	const ID_PREFIX = 'id-';

	component.exports = {
		data () {
			if (!Ractive.isServer) {
				marked.setOptions({
					langPrefix: 'hljs language-',
					headerIds: true,
					headerPrefix: ID_PREFIX,
					highlight (code, language) {
						return hljs.getLanguage(language) ? hljs.highlightAuto(code, [ 'html', 'javascript', 'sh', 'bash' ]).value : code;
					},
				});

				let renderer = {
					link (href, title, text) {
						return `
							<a href="${href}" target="_blank" rel="noopener noreferrer nofollow">
								${text}
							</a>
						`;
					},
				};

				marked.use({ renderer });
			}

			return {
				text: '',
				markdown (md) {
					return !Ractive.isServer ? marked.parse(md) : '';
				},
			};
		},
	};
</script>
